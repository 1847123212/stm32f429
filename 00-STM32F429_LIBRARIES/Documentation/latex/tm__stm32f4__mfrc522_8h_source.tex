\hypertarget{tm__stm32f4__mfrc522_8h_source}{}\subsection{tm\+\_\+stm32f4\+\_\+mfrc522.\+h}

\begin{DoxyCode}
00001 
00054 \textcolor{preprocessor}{#ifndef TM\_MFRC522\_H}
00055 \textcolor{preprocessor}{#define TM\_MFRC522\_H 100}
00056 
00067 \textcolor{preprocessor}{#include "stm32f4xx.h"}
00068 \textcolor{preprocessor}{#include "stm32f4xx\_rcc.h"}
00069 \textcolor{preprocessor}{#include "stm32f4xx\_gpio.h"}
00070 \textcolor{preprocessor}{#include "tm\_stm32f4\_spi.h"}
00071 \textcolor{preprocessor}{#include "defines.h"}
00072 
00078 \textcolor{comment}{/* Default SPI used */}
00079 \textcolor{preprocessor}{#ifndef MFRC522\_SPI}
00080 \textcolor{preprocessor}{#define MFRC522\_SPI                     SPI1}
00081 \textcolor{preprocessor}{#define MFRC522\_SPI\_PINSPACK            TM\_SPI\_PinsPack\_2}
00082 \textcolor{preprocessor}{#endif}
00083 
00084 \textcolor{comment}{/* Default CS pin used */}
00085 \textcolor{preprocessor}{#ifndef MFRC522\_CS\_PIN}
00086 \textcolor{preprocessor}{#define MFRC522\_CS\_RCC                  RCC\_AHB1Periph\_GPIOG}
00087 \textcolor{preprocessor}{#define MFRC522\_CS\_PORT                 GPIOG}
00088 \textcolor{preprocessor}{#define MFRC522\_CS\_PIN                  GPIO\_Pin\_2}
00089 \textcolor{preprocessor}{#endif}
00090 
00096 \textcolor{keyword}{typedef} \textcolor{keyword}{enum} \{
00097     MI\_OK = 0,
00098     MI\_NOTAGERR,
00099     MI\_ERR
00100 \} TM\_MFRC522\_Status\_t;
00101 
00102 \textcolor{preprocessor}{#define MFRC522\_CS\_LOW                  MFRC522\_CS\_PORT->BSRRH = MFRC522\_CS\_PIN;}
00103 \textcolor{preprocessor}{#define MFRC522\_CS\_HIGH                 MFRC522\_CS\_PORT->BSRRL = MFRC522\_CS\_PIN;}
00104 
00105 \textcolor{comment}{/* MFRC522 Commands */}
00106 \textcolor{preprocessor}{#define PCD\_IDLE                        0x00   //NO action; Cancel the current command}
00107 \textcolor{preprocessor}{#define PCD\_AUTHENT                     0x0E   //Authentication Key}
00108 \textcolor{preprocessor}{#define PCD\_RECEIVE                     0x08   //Receive Data}
00109 \textcolor{preprocessor}{#define PCD\_TRANSMIT                    0x04   //Transmit data}
00110 \textcolor{preprocessor}{#define PCD\_TRANSCEIVE                  0x0C   //Transmit and receive data,}
00111 \textcolor{preprocessor}{#define PCD\_RESETPHASE                  0x0F   //Reset}
00112 \textcolor{preprocessor}{#define PCD\_CALCCRC                     0x03   //CRC Calculate}
00113 
00114 \textcolor{comment}{/* Mifare\_One card command word */}
00115 \textcolor{preprocessor}{#define PICC\_REQIDL                     0x26   // find the antenna area does not enter hibernation}
00116 \textcolor{preprocessor}{#define PICC\_REQALL                     0x52   // find all the cards antenna area}
00117 \textcolor{preprocessor}{#define PICC\_ANTICOLL                   0x93   // anti-collision}
00118 \textcolor{preprocessor}{#define PICC\_SElECTTAG                  0x93   // election card}
00119 \textcolor{preprocessor}{#define PICC\_AUTHENT1A                  0x60   // authentication key A}
00120 \textcolor{preprocessor}{#define PICC\_AUTHENT1B                  0x61   // authentication key B}
00121 \textcolor{preprocessor}{#define PICC\_READ                       0x30   // Read Block}
00122 \textcolor{preprocessor}{#define PICC\_WRITE                      0xA0   // write block}
00123 \textcolor{preprocessor}{#define PICC\_DECREMENT                  0xC0   // debit}
00124 \textcolor{preprocessor}{#define PICC\_INCREMENT                  0xC1   // recharge}
00125 \textcolor{preprocessor}{#define PICC\_RESTORE                    0xC2   // transfer block data to the buffer}
00126 \textcolor{preprocessor}{#define PICC\_TRANSFER                   0xB0   // save the data in the buffer}
00127 \textcolor{preprocessor}{#define PICC\_HALT                       0x50   // Sleep}
00128 
00129 \textcolor{comment}{/* MFRC522 Registers */}
00130 \textcolor{comment}{//Page 0: Command and Status}
00131 \textcolor{preprocessor}{#define MFRC522\_REG\_RESERVED00          0x00    }
00132 \textcolor{preprocessor}{#define MFRC522\_REG\_COMMAND             0x01    }
00133 \textcolor{preprocessor}{#define MFRC522\_REG\_COMM\_IE\_N           0x02    }
00134 \textcolor{preprocessor}{#define MFRC522\_REG\_DIV1\_EN             0x03    }
00135 \textcolor{preprocessor}{#define MFRC522\_REG\_COMM\_IRQ            0x04    }
00136 \textcolor{preprocessor}{#define MFRC522\_REG\_DIV\_IRQ             0x05}
00137 \textcolor{preprocessor}{#define MFRC522\_REG\_ERROR               0x06    }
00138 \textcolor{preprocessor}{#define MFRC522\_REG\_STATUS1             0x07    }
00139 \textcolor{preprocessor}{#define MFRC522\_REG\_STATUS2             0x08    }
00140 \textcolor{preprocessor}{#define MFRC522\_REG\_FIFO\_DATA           0x09}
00141 \textcolor{preprocessor}{#define MFRC522\_REG\_FIFO\_LEVEL          0x0A}
00142 \textcolor{preprocessor}{#define MFRC522\_REG\_WATER\_LEVEL         0x0B}
00143 \textcolor{preprocessor}{#define MFRC522\_REG\_CONTROL             0x0C}
00144 \textcolor{preprocessor}{#define MFRC522\_REG\_BIT\_FRAMING         0x0D}
00145 \textcolor{preprocessor}{#define MFRC522\_REG\_COLL                0x0E}
00146 \textcolor{preprocessor}{#define MFRC522\_REG\_RESERVED01          0x0F}
00147 \textcolor{comment}{//Page 1: Command }
00148 \textcolor{preprocessor}{#define MFRC522\_REG\_RESERVED10          0x10}
00149 \textcolor{preprocessor}{#define MFRC522\_REG\_MODE                0x11}
00150 \textcolor{preprocessor}{#define MFRC522\_REG\_TX\_MODE             0x12}
00151 \textcolor{preprocessor}{#define MFRC522\_REG\_RX\_MODE             0x13}
00152 \textcolor{preprocessor}{#define MFRC522\_REG\_TX\_CONTROL          0x14}
00153 \textcolor{preprocessor}{#define MFRC522\_REG\_TX\_AUTO             0x15}
00154 \textcolor{preprocessor}{#define MFRC522\_REG\_TX\_SELL             0x16}
00155 \textcolor{preprocessor}{#define MFRC522\_REG\_RX\_SELL             0x17}
00156 \textcolor{preprocessor}{#define MFRC522\_REG\_RX\_THRESHOLD        0x18}
00157 \textcolor{preprocessor}{#define MFRC522\_REG\_DEMOD               0x19}
00158 \textcolor{preprocessor}{#define MFRC522\_REG\_RESERVED11          0x1A}
00159 \textcolor{preprocessor}{#define MFRC522\_REG\_RESERVED12          0x1B}
00160 \textcolor{preprocessor}{#define MFRC522\_REG\_MIFARE              0x1C}
00161 \textcolor{preprocessor}{#define MFRC522\_REG\_RESERVED13          0x1D}
00162 \textcolor{preprocessor}{#define MFRC522\_REG\_RESERVED14          0x1E}
00163 \textcolor{preprocessor}{#define MFRC522\_REG\_SERIALSPEED         0x1F}
00164 \textcolor{comment}{//Page 2: CFG    }
00165 \textcolor{preprocessor}{#define MFRC522\_REG\_RESERVED20          0x20  }
00166 \textcolor{preprocessor}{#define MFRC522\_REG\_CRC\_RESULT\_M        0x21}
00167 \textcolor{preprocessor}{#define MFRC522\_REG\_CRC\_RESULT\_L        0x22}
00168 \textcolor{preprocessor}{#define MFRC522\_REG\_RESERVED21          0x23}
00169 \textcolor{preprocessor}{#define MFRC522\_REG\_MOD\_WIDTH           0x24}
00170 \textcolor{preprocessor}{#define MFRC522\_REG\_RESERVED22          0x25}
00171 \textcolor{preprocessor}{#define MFRC522\_REG\_RF\_CFG              0x26}
00172 \textcolor{preprocessor}{#define MFRC522\_REG\_GS\_N                0x27}
00173 \textcolor{preprocessor}{#define MFRC522\_REG\_CWGS\_PREG           0x28}
00174 \textcolor{preprocessor}{#define MFRC522\_REG\_\_MODGS\_PREG         0x29}
00175 \textcolor{preprocessor}{#define MFRC522\_REG\_T\_MODE              0x2A}
00176 \textcolor{preprocessor}{#define MFRC522\_REG\_T\_PRESCALER         0x2B}
00177 \textcolor{preprocessor}{#define MFRC522\_REG\_T\_RELOAD\_H          0x2C}
00178 \textcolor{preprocessor}{#define MFRC522\_REG\_T\_RELOAD\_L          0x2D}
00179 \textcolor{preprocessor}{#define MFRC522\_REG\_T\_COUNTER\_VALUE\_H   0x2E}
00180 \textcolor{preprocessor}{#define MFRC522\_REG\_T\_COUNTER\_VALUE\_L   0x2F}
00181 \textcolor{comment}{//Page 3:TestRegister }
00182 \textcolor{preprocessor}{#define MFRC522\_REG\_RESERVED30          0x30}
00183 \textcolor{preprocessor}{#define MFRC522\_REG\_TEST\_SEL1           0x31}
00184 \textcolor{preprocessor}{#define MFRC522\_REG\_TEST\_SEL2           0x32}
00185 \textcolor{preprocessor}{#define MFRC522\_REG\_TEST\_PIN\_EN         0x33}
00186 \textcolor{preprocessor}{#define MFRC522\_REG\_TEST\_PIN\_VALUE      0x34}
00187 \textcolor{preprocessor}{#define MFRC522\_REG\_TEST\_BUS            0x35}
00188 \textcolor{preprocessor}{#define MFRC522\_REG\_AUTO\_TEST           0x36}
00189 \textcolor{preprocessor}{#define MFRC522\_REG\_VERSION             0x37}
00190 \textcolor{preprocessor}{#define MFRC522\_REG\_ANALOG\_TEST         0x38}
00191 \textcolor{preprocessor}{#define MFRC522\_REG\_TEST\_ADC1           0x39  }
00192 \textcolor{preprocessor}{#define MFRC522\_REG\_TEST\_ADC2           0x3A   }
00193 \textcolor{preprocessor}{#define MFRC522\_REG\_TEST\_ADC0           0x3B   }
00194 \textcolor{preprocessor}{#define MFRC522\_REG\_RESERVED31          0x3C   }
00195 \textcolor{preprocessor}{#define MFRC522\_REG\_RESERVED32          0x3D}
00196 \textcolor{preprocessor}{#define MFRC522\_REG\_RESERVED33          0x3E   }
00197 \textcolor{preprocessor}{#define MFRC522\_REG\_RESERVED34          0x3F}
00198 \textcolor{comment}{//Dummy byte}
00199 \textcolor{preprocessor}{#define MFRC522\_DUMMY                   0x00}
00200 
00201 \textcolor{preprocessor}{#define MFRC522\_MAX\_LEN                 16}
00202 
00212 \textcolor{keyword}{extern} \textcolor{keywordtype}{void} TM\_MFRC522\_Init(\textcolor{keywordtype}{void});
00213 
00224 \textcolor{keyword}{extern} TM\_MFRC522\_Status\_t TM\_MFRC522\_Check(uint8\_t* \textcolor{keywordtype}{id});
00225 
00238 \textcolor{keyword}{extern} TM\_MFRC522\_Status\_t TM\_MFRC522\_Compare(uint8\_t* CardID, uint8\_t* CompareID);
00239 
00243 \textcolor{keyword}{extern} \textcolor{keywordtype}{void} TM\_MFRC522\_InitPins(\textcolor{keywordtype}{void});
00244 \textcolor{keyword}{extern} \textcolor{keywordtype}{void} TM\_MFRC522\_WriteRegister(uint8\_t addr, uint8\_t val);
00245 \textcolor{keyword}{extern} uint8\_t TM\_MFRC522\_ReadRegister(uint8\_t addr);
00246 \textcolor{keyword}{extern} \textcolor{keywordtype}{void} TM\_MFRC522\_SetBitMask(uint8\_t reg, uint8\_t mask);
00247 \textcolor{keyword}{extern} \textcolor{keywordtype}{void} TM\_MFRC522\_ClearBitMask(uint8\_t reg, uint8\_t mask);
00248 \textcolor{keyword}{extern} \textcolor{keywordtype}{void} TM\_MFRC522\_AntennaOn(\textcolor{keywordtype}{void});
00249 \textcolor{keyword}{extern} \textcolor{keywordtype}{void} TM\_MFRC522\_AntennaOff(\textcolor{keywordtype}{void});
00250 \textcolor{keyword}{extern} \textcolor{keywordtype}{void} TM\_MFRC522\_Reset(\textcolor{keywordtype}{void});
00251 \textcolor{keyword}{extern} TM\_MFRC522\_Status\_t TM\_MFRC522\_Request(uint8\_t reqMode, uint8\_t* TagType);
00252 \textcolor{keyword}{extern} TM\_MFRC522\_Status\_t TM\_MFRC522\_ToCard(uint8\_t command, uint8\_t* sendData, uint8\_t sendLen, uint8\_t* 
      backData, uint16\_t* backLen);
00253 \textcolor{keyword}{extern} TM\_MFRC522\_Status\_t TM\_MFRC522\_Anticoll(uint8\_t* serNum);
00254 \textcolor{keyword}{extern} \textcolor{keywordtype}{void} TM\_MFRC522\_CalculateCRC(uint8\_t* pIndata, uint8\_t len, uint8\_t* pOutData);
00255 \textcolor{keyword}{extern} uint8\_t TM\_MFRC522\_SelectTag(uint8\_t* serNum);
00256 \textcolor{keyword}{extern} TM\_MFRC522\_Status\_t TM\_MFRC522\_Auth(uint8\_t authMode, uint8\_t BlockAddr, uint8\_t* Sectorkey, uint8\_t
      * serNum);
00257 \textcolor{keyword}{extern} TM\_MFRC522\_Status\_t TM\_MFRC522\_Read(uint8\_t blockAddr, uint8\_t* recvData);
00258 \textcolor{keyword}{extern} TM\_MFRC522\_Status\_t TM\_MFRC522\_Write(uint8\_t blockAddr, uint8\_t* writeData);
00259 \textcolor{keyword}{extern} \textcolor{keywordtype}{void} TM\_MFRC522\_Halt(\textcolor{keywordtype}{void});
00260 
00261 \textcolor{preprocessor}{#endif}
00262 
\end{DoxyCode}
