\hypertarget{tm__stm32f4__keypad_8h_source}{}\subsection{tm\+\_\+stm32f4\+\_\+keypad.\+h}

\begin{DoxyCode}
00001 
00090 \textcolor{preprocessor}{#ifndef TM\_KEYPAD\_H}
00091 \textcolor{preprocessor}{#define TM\_KEYPAD\_H 110}
00092 
00101 \textcolor{preprocessor}{#include "stm32f4xx.h"}
00102 \textcolor{preprocessor}{#include "defines.h"}
00103 \textcolor{preprocessor}{#include "tm\_stm32f4\_gpio.h"}
00104 
00105 \textcolor{comment}{/* Debounce counter */}
00106 \textcolor{preprocessor}{#ifndef KEYPAD\_DEBOUNCE}
00107 \textcolor{preprocessor}{#define KEYPAD\_DEBOUNCE                 5000}
00108 \textcolor{preprocessor}{#endif}
00109 
00110 \textcolor{preprocessor}{#ifndef KEYPAD\_HOLD\_DEBOUNCE\_DIVIDER}
00111 \textcolor{preprocessor}{#define KEYPAD\_HOLD\_DEBOUNCE\_DIVIDER    1}
00112 \textcolor{preprocessor}{#endif}
00113 
00114 \textcolor{comment}{/* First hold button debounce counters = 1 second between presses */}
00115 \textcolor{comment}{/* Multiplier according to normal debounce */}
00116 \textcolor{comment}{/* 10 times more time to wait before start */}
00117 \textcolor{preprocessor}{#ifndef KEYPAD\_FIRST\_HOLD\_MULTIPLIER}
00118 \textcolor{preprocessor}{#define KEYPAD\_FIRST\_HOLD\_MULTIPLIER    6}
00119 \textcolor{preprocessor}{#endif}
00120 
00121 \textcolor{comment}{/* Hold button debounce counters, at 168MHz clock ~ 10 Hz max */}
00122 \textcolor{preprocessor}{#define KEYPAD\_HOLD\_DEBOUNCE\_0      32653}
00123 \textcolor{preprocessor}{#define KEYPAD\_HOLD\_DEBOUNCE\_1      77777}
00124 \textcolor{preprocessor}{#define KEYPAD\_HOLD\_DEBOUNCE\_2      40000}
00125 \textcolor{preprocessor}{#define KEYPAD\_HOLD\_DEBOUNCE\_3      26936}
00126 \textcolor{preprocessor}{#define KEYPAD\_HOLD\_DEBOUNCE\_4      67796}
00127 \textcolor{preprocessor}{#define KEYPAD\_HOLD\_DEBOUNCE\_5      37037}
00128 \textcolor{preprocessor}{#define KEYPAD\_HOLD\_DEBOUNCE\_6      25581}
00129 \textcolor{preprocessor}{#define KEYPAD\_HOLD\_DEBOUNCE\_7      61100}
00130 \textcolor{preprocessor}{#define KEYPAD\_HOLD\_DEBOUNCE\_8      35010}
00131 \textcolor{preprocessor}{#define KEYPAD\_HOLD\_DEBOUNCE\_9      24560}
00132 \textcolor{preprocessor}{#define KEYPAD\_HOLD\_DEBOUNCE\_STAR   54421}
00133 \textcolor{preprocessor}{#define KEYPAD\_HOLD\_DEBOUNCE\_HASH   23323}
00134 \textcolor{preprocessor}{#define KEYPAD\_HOLD\_DEBOUNCE\_A      20000}
00135 \textcolor{preprocessor}{#define KEYPAD\_HOLD\_DEBOUNCE\_B      19230}
00136 \textcolor{preprocessor}{#define KEYPAD\_HOLD\_DEBOUNCE\_C      18691}
00137 \textcolor{preprocessor}{#define KEYPAD\_HOLD\_DEBOUNCE\_D      18000}
00138 
00139 \textcolor{comment}{/* First debounce */}
00140 \textcolor{comment}{/* Counter for first debounce, from first valid data to hold valid */}
00141 \textcolor{preprocessor}{#ifndef KEYPAD\_FIRST\_DEBOUNCE}
00142 \textcolor{preprocessor}{#define KEYPAD\_FIRST\_DEBOUNCE       300000}
00143 \textcolor{preprocessor}{#endif}
00144 
00145 \textcolor{comment}{/* Rows */}
00146 \textcolor{comment}{/* Row 1 default */}
00147 \textcolor{preprocessor}{#ifndef KEYPAD\_ROW\_1\_PIN}
00148 \textcolor{preprocessor}{#define KEYPAD\_ROW\_1\_PORT           GPIOC}
00149 \textcolor{preprocessor}{#define KEYPAD\_ROW\_1\_PIN            GPIO\_PIN\_1}
00150 \textcolor{preprocessor}{#endif}
00151 \textcolor{comment}{/* Row 2 default */}
00152 \textcolor{preprocessor}{#ifndef KEYPAD\_ROW\_2\_PIN}
00153 \textcolor{preprocessor}{#define KEYPAD\_ROW\_2\_PORT           GPIOC}
00154 \textcolor{preprocessor}{#define KEYPAD\_ROW\_2\_PIN            GPIO\_PIN\_2}
00155 \textcolor{preprocessor}{#endif}
00156 \textcolor{comment}{/* Row 3 default */}
00157 \textcolor{preprocessor}{#ifndef KEYPAD\_ROW\_3\_PIN}
00158 \textcolor{preprocessor}{#define KEYPAD\_ROW\_3\_PORT           GPIOC}
00159 \textcolor{preprocessor}{#define KEYPAD\_ROW\_3\_PIN            GPIO\_PIN\_3}
00160 \textcolor{preprocessor}{#endif}
00161 \textcolor{comment}{/* Row 4 default */}
00162 \textcolor{preprocessor}{#ifndef KEYPAD\_ROW\_4\_PIN}
00163 \textcolor{preprocessor}{#define KEYPAD\_ROW\_4\_PORT           GPIOC}
00164 \textcolor{preprocessor}{#define KEYPAD\_ROW\_4\_PIN            GPIO\_PIN\_5}
00165 \textcolor{preprocessor}{#endif}
00166 
00167 \textcolor{comment}{/* Columns */}
00168 \textcolor{comment}{/* Column 1 default */}
00169 \textcolor{preprocessor}{#ifndef KEYPAD\_COLUMN\_1\_PIN}
00170 \textcolor{preprocessor}{#define KEYPAD\_COLUMN\_1\_PORT        GPIOD}
00171 \textcolor{preprocessor}{#define KEYPAD\_COLUMN\_1\_PIN         GPIO\_PIN\_0}
00172 \textcolor{preprocessor}{#endif}
00173 \textcolor{comment}{/* Column 2 default */}
00174 \textcolor{preprocessor}{#ifndef KEYPAD\_COLUMN\_2\_PIN}
00175 \textcolor{preprocessor}{#define KEYPAD\_COLUMN\_2\_PORT        GPIOD}
00176 \textcolor{preprocessor}{#define KEYPAD\_COLUMN\_2\_PIN         GPIO\_PIN\_1}
00177 \textcolor{preprocessor}{#endif}
00178 \textcolor{comment}{/* Column 3 default */}
00179 \textcolor{preprocessor}{#ifndef KEYPAD\_COLUMN\_3\_PIN}
00180 \textcolor{preprocessor}{#define KEYPAD\_COLUMN\_3\_PORT        GPIOD}
00181 \textcolor{preprocessor}{#define KEYPAD\_COLUMN\_3\_PIN         GPIO\_PIN\_2}
00182 \textcolor{preprocessor}{#endif}
00183 \textcolor{comment}{/* Column 4 default */}
00184 \textcolor{preprocessor}{#ifndef KEYPAD\_COLUMN\_4\_PIN}
00185 \textcolor{preprocessor}{#define KEYPAD\_COLUMN\_4\_PORT        GPIOD}
00186 \textcolor{preprocessor}{#define KEYPAD\_COLUMN\_4\_PIN         GPIO\_PIN\_3}
00187 \textcolor{preprocessor}{#endif}
00188 
00189 \textcolor{comment}{/* Pins configuration, columns are outputs */}
00190 \textcolor{preprocessor}{#define KEYPAD\_COLUMN\_1\_HIGH        TM\_GPIO\_SetPinHigh(KEYPAD\_COLUMN\_1\_PORT, KEYPAD\_COLUMN\_1\_PIN)}
00191 \textcolor{preprocessor}{#define KEYPAD\_COLUMN\_1\_LOW         TM\_GPIO\_SetPinLow(KEYPAD\_COLUMN\_1\_PORT, KEYPAD\_COLUMN\_1\_PIN)}
00192 \textcolor{preprocessor}{#define KEYPAD\_COLUMN\_2\_HIGH        TM\_GPIO\_SetPinHigh(KEYPAD\_COLUMN\_2\_PORT, KEYPAD\_COLUMN\_2\_PIN)}
00193 \textcolor{preprocessor}{#define KEYPAD\_COLUMN\_2\_LOW         TM\_GPIO\_SetPinLow(KEYPAD\_COLUMN\_2\_PORT, KEYPAD\_COLUMN\_2\_PIN)}
00194 \textcolor{preprocessor}{#define KEYPAD\_COLUMN\_3\_HIGH        TM\_GPIO\_SetPinHigh(KEYPAD\_COLUMN\_3\_PORT, KEYPAD\_COLUMN\_3\_PIN)}
00195 \textcolor{preprocessor}{#define KEYPAD\_COLUMN\_3\_LOW         TM\_GPIO\_SetPinLow(KEYPAD\_COLUMN\_3\_PORT, KEYPAD\_COLUMN\_3\_PIN)}
00196 \textcolor{preprocessor}{#define KEYPAD\_COLUMN\_4\_HIGH        TM\_GPIO\_SetPinHigh(KEYPAD\_COLUMN\_4\_PORT, KEYPAD\_COLUMN\_4\_PIN)}
00197 \textcolor{preprocessor}{#define KEYPAD\_COLUMN\_4\_LOW         TM\_GPIO\_SetPinLow(KEYPAD\_COLUMN\_4\_PORT, KEYPAD\_COLUMN\_4\_PIN)}
00198 
00199 \textcolor{comment}{/* Read input pins */}
00200 \textcolor{preprocessor}{#define KEYPAD\_ROW\_1\_CHECK          (!TM\_GPIO\_GetInputPinValue(KEYPAD\_ROW\_1\_PORT, KEYPAD\_ROW\_1\_PIN))}
00201 \textcolor{preprocessor}{#define KEYPAD\_ROW\_2\_CHECK          (!TM\_GPIO\_GetInputPinValue(KEYPAD\_ROW\_2\_PORT, KEYPAD\_ROW\_2\_PIN))}
00202 \textcolor{preprocessor}{#define KEYPAD\_ROW\_3\_CHECK          (!TM\_GPIO\_GetInputPinValue(KEYPAD\_ROW\_3\_PORT, KEYPAD\_ROW\_3\_PIN))}
00203 \textcolor{preprocessor}{#define KEYPAD\_ROW\_4\_CHECK          (!TM\_GPIO\_GetInputPinValue(KEYPAD\_ROW\_4\_PORT, KEYPAD\_ROW\_4\_PIN))}
00204 
00205 \textcolor{comment}{/* Keypad no pressed */}
00206 \textcolor{preprocessor}{#define KEYPAD\_NO\_PRESSED           (uint8\_t)0xFF}
00207 
00213 \textcolor{keyword}{typedef} \textcolor{keyword}{enum} \{
00214     TM\_KEYPAD\_Button\_0 = 0x00,
00215     TM\_KEYPAD\_Button\_1 = 0x01,
00216     TM\_KEYPAD\_Button\_2 = 0x02,
00217     TM\_KEYPAD\_Button\_3 = 0x03,
00218     TM\_KEYPAD\_Button\_4 = 0x04,
00219     TM\_KEYPAD\_Button\_5 = 0x05,
00220     TM\_KEYPAD\_Button\_6 = 0x06,
00221     TM\_KEYPAD\_Button\_7 = 0x07,
00222     TM\_KEYPAD\_Button\_8 = 0x08,
00223     TM\_KEYPAD\_Button\_9 = 0x09,
00224     TM\_KEYPAD\_Button\_STAR = 0x0A,
00225     TM\_KEYPAD\_Button\_HASH = 0x0B,
00226     TM\_KEYPAD\_Button\_A = 0x0C,  \textcolor{comment}{/* Only on large size */}
00227     TM\_KEYPAD\_Button\_B = 0x0D,  \textcolor{comment}{/* Only on large size */}
00228     TM\_KEYPAD\_Button\_C = 0x0E,  \textcolor{comment}{/* Only on large size */}
00229     TM\_KEYPAD\_Button\_D = 0x0F,  \textcolor{comment}{/* Only on large size */}
00230     TM\_KEYPAD\_Button\_NOPRESSED = KEYPAD\_NO\_PRESSED
00231 \} TM\_KEYPAD\_Button\_t;
00232 
00242 \textcolor{keyword}{typedef} \textcolor{keyword}{enum} \{
00243     TM\_KEYPAD\_Type\_Large,
00244     TM\_KEYPAD\_Type\_Small
00245 \} TM\_KEYPAD\_Type\_t;
00246 
00254 \textcolor{keyword}{extern} \textcolor{keywordtype}{void} TM\_KEYPAD\_Init(TM\_KEYPAD\_Type\_t type);
00255 
00262 \textcolor{keyword}{extern} TM\_KEYPAD\_Button\_t TM\_KEYPAD\_Read(\textcolor{keywordtype}{void});
00263 
00264 \textcolor{preprocessor}{#endif}
00265 
\end{DoxyCode}
